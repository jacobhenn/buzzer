// Generated by CoffeeScript 2.5.1
(function() {
  var checkServerBuzzer, clientState, command, doUpdateScores, post, updateBuzzer, updateScores, url;

  doUpdateScores = true;

  clientState = {
    buzzer: ""
  };

  url = "http://127.0.0.1:8080/";

  // send a POST request
  post = function(path, body) {
    return fetch(url + path, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(body)
    });
  };

  // change the page if the buzzer's state has changed
  checkServerBuzzer = function(serverState) {
    if (serverState.buzzer === clientState.buzzer) {

    } else if (serverState.buzzer === "Open") {
      $("#wait").show();
      $("#check-answer").hide();
      return $("#ask-question").hide();
    } else if (serverState.buzzer === "Closed") {
      updateScores();
      $("#ask-question").show();
      $("#check-answer").hide();
      return $("#wait").hide();
    } else {
      $("#check-answer").show();
      $("#ask-question").hide();
      $("#wait").hide();
      return $(".player").text(serverState.owner);
    }
  };

  // fetch the scores, then format and display them
  updateScores = function() {
    return fetch(url + "state/scores").then((response) => {
      return response.json();
    }).then(function(response) {
      return $("#scores").html((response.map((team) => {
        return team.name + " " + team.score;
      })).join("<br/>"));
    });
  };

  // fetch the state of the buzzer and update the page accordingly
  updateBuzzer = function() {
    fetch(url + "state/buzzer").then((response) => {
      return response.json();
    }).then(function(response) {
      checkServerBuzzer(response);
      return clientState = response;
    });
    if (doUpdateScores) {
      return updateScores();
    }
  };

  command = function(data) {
    return post("command", data);
  };

  $("#open").click(function() {
    command({
      action: "OpenBuzzer"
    });
    if (doUpdateScores) {
      return doUpdateScores = false;
    }
  });

  $("#incorrect").click(function() {
    return command({
      action: "OpenBuzzer"
    });
  });

  $("#end-round").click(function() {
    return command({
      action: "EndRound"
    });
  });

  $("#correct").click(function() {
    command({
      action: "AddScore",
      name: clientState.owner,
      score: parseInt(($("#points")).val())
    });
    return command({
      action: "EndRound"
    });
  });

  setInterval(updateBuzzer, 100);

}).call(this);
